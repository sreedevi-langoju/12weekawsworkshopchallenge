# AWS Identity and Access Management (IAM) -Users, User Groups, Roles, Policies:

 
Creating IAM users, groups, roles, and policies involves using the AWS Management Console, AWS CLI (Command Line Interface), or AWS SDKs (Software Development Kits). AWS Identity and Access Management (IAM) Immersion Day- How to create the IAM entities using the AWS Management Console:

### Creating an IAM User:

Now, we're going to create an Administrator user. When we create an IAM user, we create a password for that user and attach permissions to the IAM user that give them administrator privileges.

You can create up to 5000 IAM Users in a single AWS account. You may need to create an IAM User when you onboard someone who needs access to AWS, or when launching a new workload that needs to make API calls to AWS.

#### Creating an IAM User through the Console:

* Sign in to the AWS Management Console and open the IAM console.  In the left side navigation pane, choose Users and then choose Add users.
* Type the user name as demouser for the new user, this is the sign-in name for AWS.

* Now we'll need to select the type of access this set of users will have. Be sure to review use cases for the different types of access below:
Programmatic Access used to be an option here but that has since been removed. This type of access is now provided after user creation
Select AWS Management Console Access if the users require access to the AWS Management Console. This creates a password for each new user. When choosing Console Access you can also choose between the following password settings.

a) Autogenerated password. Each user gets a randomly generated password that meets the account password policy.  You can view or download the passwords when you get to the Final page. You can also force users to set a new password upon initial login by checking the Require password reset box.

b)Custom password. Each user is assigned the password that you type in the box.

* Normally, we recommend that you select Require password reset for production accounts to ensure that users are forced to change their password the first time they sign in.
  
* For this example, let's select

  Provide user access to the AWS Management Console
  I want to create an IAM user
  Autogenerated Password
  uncheck Users must create a new password at next sign-in

<img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/422af6bd-0682-4683-9490-e06b16524d7b">

* Once we're on the Set permissions page, we'll need to specify how we want to assign permissions to this set of new users. We'll need to choose one of the following three options:
  
  a) Add user to group. Choose this option if you want to assign the users to one or more groups that already have permissions policies.

  b) Copy permissions from existing user. Choose this option to copy all of the group memberships, attached managed policies, embedded inline policies, and any   existing permissions boundaries from an existing user to the new users.

  c) Attach existing policies directly. Choose this option to see a list of the AWS managed and customer managed policies in your account. Select the policies that you want to attach to the new users or choose Create policy to open a new browser tab and create a new policy from scratch.

* Because we're creating a new Administrator user, we'll choose the Attach Existing Policies option. Pick the AdministratorAccess policy and attach it to your user to grant the relevant permissions. Choose Next: Tags.

<img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/6014d69b-dcdc-475c-a5e8-b5b151b92e30">  

*[Optional] You can add metadata to the user by attaching tags as key-value pairs. Add a key-value pair if desired.

* Here you can see all of the choices you made up to this point.

Take note of the new credentials and the sign-in link. When you are ready to proceed, choose Create.

* Take note of your sign in details including your sign-in URL and .csv file.
The URL is a quick sign on page that auto-fills your information
The .csv file keeps track of the users password. If it was auto-generated, please make sure you download it or you will have to recreate your user. 

* IAM Users are identified in the following ways:

  a)A "friendly name" for the user, which is the name that you specified when you created the user, such as Richard or Anaya. These are the names you see in the AWS Management Console.

  b)An Amazon Resource Name (ARN) for the user. You use the ARN when you need to uniquely identify the user across all of AWS. For example, you could use an ARN to specify the user as a Principal in an IAM policy for an Amazon S3 bucket. An ARN for an IAM user might look like the following:

  arn:aws:iam::123456789012:user/Administrator
  
* A unique identifier for the user. This ID is returned only when you use the API, Tools for Windows PowerShell, or AWS CLI to create the user; you do not see this ID in the console.

* You can find the ARN for a user by navigating to the IAM console, choosing Users from the left side panel, then selecting the User you want more detail on.
* Navigate to the sign-in page . Sign in with the new user you just created. You should be able to sign and test the permissions of the new IAM User you created!


### Creating a User Group:

To set up a user group, you need to create the group, add users to the group, then give the group permissions based on the type of work that you expect the users in the group to do. In this lab, we'll be:

1.Creating a new user called PowerUser
2.Creating a new user group called Developers
3.Adding PowerUser user to the Developers group. This will grant them permissions to manage our EC2 Server resources for the business.

#### Creating an IAM User

Create a new user with the name PowerUser and skip the step of adding any permissions. By not attaching any policies to the user upon creation, you will essentially create a user with no permissions at all. Alternatively, you can remove any policies from an existing user to acheive the same goal.

If you're unsure of how to create a user, please refer to the Creating an IAM User lab.

<img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/1a8d98db-812f-4c45-8ae3-c0dac2c872b9">

#### To create an IAM user group and attach policies through the group (console)

* Sign in to the AWS Management Console and open the IAM console ]

* In the navigation pane, choose User groups and then choose Create group.

* For User group name, type the name of the group as Developers. In the list of users, select the check box for each user that you want to add to the group. If you created the user previously, you can choose PowerUser.
  
* In the list of policies, select the check box for each policy that you want to apply to all members of the group. We need to give our Developers EC2 access, so we'll choose the AWS Managed Policy "AmazonEC2FullAccess". Type AmazonEC2FullAccess in the search bar and select the appropriate policy.

* Choose Create group.

<img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/30caed4c-2479-4ee1-b555-2c191af646ad">

Note: You can have up to 300 IAM groups per account

Congratulations! You've created a group and attached permissions. Our permissions will now be standardized among all our developers.

### Creating an IAM Role:

Roles and users are both AWS identities with permissions policies that determine what the identity can and cannot do in AWS. However, instead of being uniquely associated with one person, a role is intended to be assumable by anyone who needs it. Also, a role does not have standard long-term credentials such as a password or access keys associated with it. Instead, when you assume a role, it provides you with temporary security credentials for your role session.

In this exercise, we're going to create a role for an EC2 instance and grant it trusted access to all S3 buckets in our account.

#### Create a Role:

* From the Console Home Screen ,type “IAM“ into the services search bar on top of the screen and choose the IAM service.

* From here Select Roles, either on the tab on the left or the middle of the screen.

* On the next page select Create role

* From here we will select the service entity EC2 and press Next: Permissions

 <img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/3a4c6baf-c6f1-4c89-ac0a-5a64dfac1945"  height=400 width=600> 

* On the next page we will add a policy to give access to any s3 storage buckets in your account. This can be achieved by filtering the search for and selecting AmazonS3FullAccess as seen below. We'll go into how policies grant permissions a little later on.

* Continue on to review and name your role EC2S3FullAccess and press Create role

<img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/6c394c50-0687-465d-a6f1-4404f2947c5b"  height=400 width=600>

* You will now be redirected to the roles section of the IAM console. You can then use the search bar to verify your IAM Role was created. Click on your role to review.
  
<img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/a0886a85-9fc8-4cf3-8e49-3b384d669014"  height=400 width=700>

<img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/1d4ca983-0621-4d22-a71e-7ca6b7d044f4" height=400 width=600>

Congratulations! You have successfully created your first IAM Role!

### Creating a Custom policy:

In this lab we will be creating an AWS Identity Policy to grant access to S3. We will then be using that policy to test our access in our new account.

1. Write the policy
2. Create a new user
3. Attach our policy to the new user
4. Test permissions

#### Designing a Custom S3 Policy:

We are going to create a JSON policy. A company has hired a new data scientist whose AWS account must have access to list and download S3 objects. We need to make a policy that, when attached to the scientist's identity in AWS, provides these permissions for S3. This requires an identity-based policy. Let's walk through creating a policy that fulfills our needs.

* From the Console Home Screen , type “IAM“ into the services search bar on top of the screen and choose the IAM service.
* From here Select Policies, either on the tab on the left or the middle of the screen.
* On the next page select Create Policy

* From the Create Policy page, we'll be walking through creating a custom policy manually, so we'll need to edit the JSON directly. Click on the JSON tab to get started

##### Version
For Version we can use the latest available, which is "2012-10-17”. For the vast majority of cases, the latest version should be used
```
{
  "Version": "2012-10-17",
  "Statement": []
}
```
##### ID
For ID, lets use an online generator(https://www.uuidgenerator.net/) to generate a UUID identifier
```
{
  "Version": "2012-10-17",
  "Id": "04d02149-8a5d-489d-9315-1541fde69f1b",
  "Statement": []
}
```
##### SID
SID only requires uniqueness inside each policy, since this is the first statement in the statement array, lets use 1
```
{
  "Version": "2012-10-17",
  "Id": "04d02149-8a5d-489d-9315-1541fde69f1b",
  "Statement": [
      {
          "Sid": "1"
      }
  ]
}
```
##### Effect
We want to allow the user to have certain S3 permissions. So we will use the “Allow” value. Valid values are Allow and Deny
```
{
  "Version": "2012-10-17",
  "Id": "04d02149-8a5d-489d-9315-1541fde69f1b",
  "Statement": [
      {
          "Sid": "1",
          "Effect": "Allow"
      }
  ]
}
```
##### Principal

Principal specifies which identities are subject to the policy, but because this is an identity-based policy that the user will assume directly, the Principal is redundant and will not be used. A resource-based policy requires a principal to be identified.

##### Action
 We want to grant permission to list and download objects from S3, so we will list the the following actions: GetObject, ListBucket, ListAllMyBuckets. For a list of all S3 defined actions, click here 

```
{
  "Version": "2012-10-17",
  "Id": "04d02149-8a5d-489d-9315-1541fde69f1b",
  "Statement": [
      {
          "Sid": "1",
          "Effect": "Allow",
          "Action": [
            "s3:GetObject",
            "s3:ListBucket",
            "s3:ListAllMyBuckets"
        ]
      }
  ]
}
```
##### Resource
We need the data scientists to have access to all S3 objects, so we will use the wildcard  (*). If we wanted to only give permissions for certain resources, we could have listed their ARNs instead.
```
{
  "Version": "2012-10-17",
  "Id": "04d02149-8a5d-489d-9315-1541fde69f1b",
  "Statement": [
      {
          "Sid": "1",
          "Effect": "Allow",
          "Action": [
            "s3:GetObject",
            "s3:ListBucket",
            "s3:ListAllMyBuckets"
        ],
        "Resource": "*"
      }
  ]
}
```
##### Condition
We want our policy to be applied all the time, not under certain conditions. So we will not include a condition block.

Recap
We now have our completed policy below. It allows anyone who inherits the policy to see existing S3 buckets in the account, and view/download the objects within each bucket.
```
{
  "Version": "2012-10-17",
  "Id": "04d02149-8a5d-489d-9315-1541fde69f1b",
  "Statement": [
      {
          "Sid": "1",
          "Effect": "Allow",
          "Action": [
            "s3:GetObject",
            "s3:ListBucket",
            "s3:ListAllMyBuckets"
        ],
        "Resource": "*"
      }
  ]
}
```

 Note: It may not be best practice to set the Resource to the wildcard "*" which will allow access to all S3 buckets in the account. It may be better to specify which buckets the user has access to by using the bucket ARN. See Granting Least Privilege 
 
* Give the new policy a name such as S3ExamplePolicy and a brief description. In the summary section, verify that the policy we created is giving the correct permissions. This policy should be giving limited "List" and "Read" permissions for S3 resources. If everything looks correct, choose Create Policy.



#### Creating and Testing a Custom S3 Policy:

Now that we've created a policy, we'll need to create a bucket to test permissions, and assign our new policy to a user and test it out.

Create an S3 bucket and upload a test.txt file(find test.txt  in this repository)
  
* From the Console Home Screen , select “S3” or type “S3” in the search bar at the top of the screen.

* Select Create bucket once inside the S3 service

* Once on the Create bucket tab, insert a unique bucket name. This name must be universally unique. An example could be s3policytest.{Your_Name}.

* Leave all other setting default and select Create bucket at the bottom of the screen.

 <img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/a60fa879-4340-458a-be70-a3ab74d21697"> 

* Navigate to your bucket and choose Upload


* [Optional] create a quick text file using the following command: echo -e "hello world" >> test.txt

* Upload any file to your bucket, try to keep it small. Click Upload when done.

  <img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/d9c41ba5-3653-4447-8e51-9332f49dc90e">

#### Create a user with the correct permissions.
  
* We need to attach this policy to an IAM identity in order to use it. Reference the "Creating an IAM User" lab to create a new user named S3User, but instead of the AdministratorAccess policy, grant the new account the S3 policy we created in a previous step.

 <img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/cb2e9ef6-fbe6-48fd-9148-4adeaf2ab064" width=600 height=500> 


#### Test newly granted permissions:

* Take note of the credentials for the newly created IAM User, then log into this account with the sign-in link  on the page. Navigate to the S3 console to test permissions.
* Using a different browser or incognito mode can allow you to sign into AWS as a different user. If you use the same browser, you'll have to sign out first.

<img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/d3f48e27-c546-46b5-9ce6-81bba6aa918f" width=300 height=400>  
  
* On the S3 console you should be able to view all buckets and download objects. Select any bucket and object within, and verify that you can download the object. Now attempt to delete an object.
  
* The console won't allow this action since we didn't grant delete permissions in the policy we created.

<img src="https://github.com/sreedevi-langoju/12weekawsworkshopchallenge/assets/135724041/52e6af44-e882-4975-8c10-37c68f124acc" height=400 width=600>

#### Conclusion
Congratulations! You successfully created a policy, attached it to a user, and verified that the permissions were set properly.



